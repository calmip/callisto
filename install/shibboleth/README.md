Authentication with SAML2, using Shibboleth
===========================================

Callisto, when installed on a server, uses Shibboleth for the authentication.
The authentication is done by the CallistoProxy container (the main reverse proxy), and propagated using http headers to the
other services (currently the portal and dataverse)

So, the shibd configuration is done in the CallistoProxy container

If you are in a french university or EPST, you should:

- Contact you institution, or Renater, to be registered in the Renater Federation:
  https://services.renater.fr/federation/index

- Fill-in the form you'll find here:
  https://federation.renater.fr/registry

- At the end of the process (tab technical information):
  DO NOT fill the "Metadata URL for your service" field
  Else, provide the correct information:

   - entityID: The callisto URL (ex. https://callisto.calmip.univ-toulouse.fr)
   - Endpoint for SAML 1.0, leave it blank (we use ONLY SAML 2)
   - Endpoint for SAML 2.0, you should fill TWO endpoints: the dataverse URL and the Allegro URL
     (ex. https://dataverse.callisto.calmip.univ-toulouse.fr and https://allegro.callisto.calmip.univ-toulouse.fr)
   - SAML X 509 certificate: paste the certificate as explained in the register

WARNING - Caution with the SAML Certificates
--------------------------------------------

Those certificates are in CallistoProxy, directory /etc/shibboleth. They are autosigned certificates, generated by Shibboleth when installed.
The files are:

- sp-encrypt-cert.pem
- sp-encrypt-key.pem
- sp-signing-cert.pem
- sp-signing-key.pem

If at some point you need to destroy and recreate the CallistoProxy container (this is easy thansk to Ansible), you should *keep those 4 files in a safe place*,
then copy the old files in place. Else, you'll have to declare again you service to the federation, because those certificates are kept inside the Metadata Service Providers of the federation.

Moking Shibboleth
=================

If you install Callisto on your laptop, to test or develop the application, you can "mock" Shibboleth, ie Callisto shall believe that
Shibboleth is in used. 

To login/logout, you should use a script (bin/mockShib.py) from your laptop (but NOT from a container):

To "login" to Callisto:
    python3 bin/mockShib.py login

To "logout" from Callisto:
    python3 bin/mockShib.py logout


