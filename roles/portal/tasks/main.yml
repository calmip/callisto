---
# tasks file for portal

- name: Add the user 'callisto'
  user:
    name: callisto
    comment: 

- name: installing configuration file
  template:
     src:  00-portal.conf
     dest: /etc/httpd/conf.d
     owner: root
     group: root
     mode: '0644'
     backup: yes
  notify: restart apache

- name: installing assets directory and other files
  copy:
     src:  callisto/{{ item }}
     dest: /var/www/html/callisto
     owner: root
     group: root
     mode: '0644'
     backup: yes
  loop:
     - assets
     - css
     - js
  when: send_all_files == true 

- name: installing login/logout for laptop installation only
  copy:
     src:  callisto/{{ item }}
     dest: /var/www/html/callisto
     owner: root
     group: root
     mode: '0644'
     backup: yes
  loop:
     - login
     - logout
  when: callisto_living_on == "laptop"


- name: installing UTILS 
  template:
     src:  UTILS/{{ item }}
     dest: /home/callisto
     owner: root
     group: root
     mode: '0644'
     backup: yes
  loop:
     - DataSetsToAllegro.py
     - GenerateDataverseMetadata.py
     - RegisterPublication.py
     - RegisterService.py
     - Update_Allegro_Repositories.py
     - demonstration.nt
     - initialize_demonstration_repository.py

- name: installing web site
  template:
     src:  callisto/{{ item }}
     dest: /var/www/html/callisto
     owner: root
     group: root
     mode: '0644'
     backup: yes
  loop:
     - index.php
     - index-dataverse.php
     - menu.inc
     - headers.inc
     - index-tools.php
     - index-work.php
     - collaborate.html
     - index-contact.php
     - work.html
     - tools.html
     - contact.html
     - license.txt

- name: creating TempFiles directory
  file:
    path: /var/www/html/callisto/TempFiles
    state: directory
    owner: root
    group: root
    mode: '0777'
    #  when: ansible_host == "CallistoPortal"

- name: installing cgi-bin
  template:
     src:  cgi-bin/{{ item }}
     dest: /var/www/cgi-bin
     owner: root
     group: root
     mode: '0644'
     backup: yes
  loop:
     - Allegro_Fcts.py
     - Constants.py
     - display.py
     - get_dataset.py
     - mean_Cp.py
     - mean_Cp_source.py
     - psd_display.py
     - psd_fft_display.py
     - psd_fft.py
     - psd_fft_source.py
     - psd_periodogram.py
     - psd_periodogram_source.py
     - psd_welch.py
     - psd_welch_source.py
     - StringDist.py
     - cgi_conf.cfg

- name: creating cgi-bin TempFiles directory
  file:
    path: /var/www/cgi-bin/TempFiles
    state: directory
    owner: root
    group: root
    mode: '0777'
    #  when: ansible_host == "CallistoPortal"

